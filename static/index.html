<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
    <input id="phoneNumberEntry" placeholder="Phone number"/>
    <button id="login" onclick="login()" style="display:none">Login</button>
    <div id="trackingDisplay">
        <h2 id="welcomeHeader">Welcome!</h2>
        <h3>Today's doses</h3>
        <h4 id="takeNow">Take now</h4>
        <div id="takeNowBody"></div>
        <h4 id="takeLater">Take later</h4>
        <div id="takeLaterBody"></div>
        <h3>Dose history</h3>
        <div id="calendar"></div>
    </div>
    <script defer>
        var runningLocally = true;  // if this is false, you're editing PROD.
        var apiURL = runningLocally ? "http://localhost:5000" : "https://coherence-chat.herokuapp.com";
        const tracking = document.getElementById("trackingDisplay");
        const phoneNumberEntry = document.getElementById("phoneNumberEntry");
        const loginButton = document.getElementById("login");
        const welcomeHeader = document.getElementById("welcomeHeader");
        const takeNowBody = document.getElementById("takeNowBody");
        const takeLaterBody = document.getElementById("takeLaterBody");
        const getInitDetails = {
            method: 'get',
            headers: {
                "Access-Control-Allow-Origin": "*",
                "Access-Control-Allow_Methods": "GET",
                "Access-Control_Allow_Headers": "*",
                "Cache-Control": "no-cache"
            },
            mode: "cors"
        };
        const postInitDetails = {
            method: 'post',
            headers: {
                "Access-Control-Allow-Origin": "*",
                "Access-Control-Allow_Methods": "POST",
                "Access-Control_Allow_Headers": "*",
                "Content-Type": "application/json; charset=utf-8",
                "Cache-Control": "no-cache"
            },
            mode: "cors",
        };
        function requestData() {
            fetch(`${apiURL}/patientData`, getInitDetails).then(response => response.json()).then(result => {
                console.log(result);
                if (!result.phoneNumber) {
                    phoneNumberDisplay.innerHTML = "you need to login";
                    phoneNumberEntry.style.display = "block";
                    loginButton.style.display = "block";

                } else {
                    welcomeHeader.innerHTML = `Welcome, ${result.phoneNumber}!`;

                    phoneNumberEntry.style.display = "none";
                    loginButton.style.display = "none";
                }
            });
        }
        function login() {
            const initDetails = {...postInitDetails, body: JSON.stringify({phoneNumber: phoneNumberEntry.value})}
            fetch(`${apiURL}/login`, initDetails).then(() => {requestData()});
        }
        requestData();
    </script>
</body>